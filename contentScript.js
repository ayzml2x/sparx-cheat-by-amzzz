const k="div[class*='_AccuracyText']",h="a[class*='_ButtonBase']",m="button[class*='_ButtonBase']",f="div[class*='_Chip']",x="div#RESULT_POPOVER",S="a[class*='_Task'][class*='_TaskClickable']",T="div[class*='_SummaryContainer']",g="div[class*='_AccordionItem']",y="div[class*='_PackageLeft'] > span",C="div[class*='_WACContainer']",i="Continue",b="Correct!",p="Next task",v="Submit",w="Summary",a=t=>new Promise(e=>{if(document.querySelector(t))return e(document.querySelector(t));const c=new MutationObserver(()=>{document.querySelector(t)&&(c.disconnect(),e(document.querySelector(t)))});c.observe(document.body,{childList:!0,subtree:!0})}),L=(t,e,c)=>{chrome.storage.local.get("screenshotURLs",o=>{const n=o.screenshotURLs;let r;n instanceof Object&&n[e]&&(r=n[e][c]),t.src=r||chrome.runtime.getURL("images/answer_not_found.png")})},l=t=>{const e=t.split("/");return e[e.indexOf("package")+1]};chrome.runtime.onMessage.addListener(t=>{t.action==="showBookworkAnswer"?a(C).then(e=>{const c=document.querySelector(f).innerText.split(" ")[1],o=document.createElement("h2");o.innerText="Answer: ";const n=document.createElement("img");n.classList.add("screenshot"),L(n,l(location.href),c);const r=document.createElement("div");r.style.textAlign="center",r.appendChild(o),r.appendChild(n),e.appendChild(r),chrome.storage.local.get("autoNext",s=>{s.autoNext===!0&&document.querySelectorAll(m).forEach(u=>{u.innerText===v&&u.addEventListener("click",()=>{a(k).then(()=>{document.querySelectorAll(m).forEach(d=>{d.innerText===i&&d.click()})})})})})}):t.action==="clickNextTask"&&chrome.storage.local.get("autoNext",e=>{e.autoNext===!0&&a(T).then(()=>{document.querySelectorAll(h).forEach(c=>{const o=c;(o.innerText===p||o.innerText===i)&&o.click()})})})});const E=new MutationObserver(t=>{t.forEach(e=>{e.addedNodes.forEach(c=>{if(c.nodeType===1){const o=c;if(o.matches(x)&&o.innerText.includes(b)){const n=document.querySelector(f).innerText.split(": ")[1];setTimeout(()=>{chrome.runtime.sendMessage({action:"takeScreenshot",packageId:l(location.href),bookworkCode:n},()=>{chrome.storage.local.get("autoNext",r=>{if(r.autoNext===!0){const s=document.querySelector(h);s&&(s.innerText===i||s.innerText===w)&&s.click()}})})},250)}else if(o.matches(S)){const n=o;n.addEventListener("click",()=>{const r=n.closest(g).querySelector(y).innerText,s=l(n.href);chrome.runtime.sendMessage({action:"setHomeworkInfos",packageId:s,homeworkInfo:r})})}}})})}),_={childList:!0,subtree:!0};E.observe(document.body,_);
